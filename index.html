<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>pixi</title>
  <link rel="stylesheet" type="text/css" href="./index.css">
  <script src="./pixi/pixi.min.js"></script>
</head>
<body>
  <script type="text/javascript">
    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }

    PIXI.utils.sayHello(type);

    //Create a Pixi Application
    let app = new PIXI.Application({width: window.innerWidth, height: window.innerHeight});
    //Add the canvas that Pixi automatically created for you to the HTML document
    document.body.appendChild(app.view);
    
    PIXI.loader
      .add("./img/drawCard.jpeg")
      .add("./img/clover1.jpeg")
      .add("./img/clover2.jpeg")
      .add("./img/clover3.jpeg")
      .add("./img/clover4.jpeg")
      .add("./img/clover5.jpeg")
      .add("./img/clover6.jpeg")
      .add("./img/clover7.jpeg")
      .add("./img/clover8.jpeg")
      .add("./img/clover9.jpeg")
      .add("./img/clover10.jpeg")
      .add("./img/clover11.jpeg")
      .add("./img/clover12.jpeg")
      .add("./img/clover13.jpeg")
      .add("./img/heart1.jpeg")
      .add("./img/heart2.jpeg")
      .add("./img/heart3.jpeg")
      .add("./img/heart4.jpeg")
      .add("./img/heart5.jpeg")
      .add("./img/heart6.jpeg")
      .add("./img/heart7.jpeg")
      .add("./img/heart8.jpeg")
      .add("./img/heart9.jpeg")
      .add("./img/heart10.jpeg")
      .add("./img/heart11.jpeg")
      .add("./img/heart12.jpeg")
      .add("./img/heart13.jpeg")
      .add("./img/pike1.jpeg")
      .add("./img/pike2.jpeg")
      .add("./img/pike3.jpeg")
      .add("./img/pike4.jpeg")
      .add("./img/pike5.jpeg")
      .add("./img/pike6.jpeg")
      .add("./img/pike7.jpeg")
      .add("./img/pike8.jpeg")
      .add("./img/pike9.jpeg")
      .add("./img/pike10.jpeg")
      .add("./img/pike11.jpeg")
      .add("./img/pike12.jpeg")
      .add("./img/pike13.jpeg")
      .add("./img/tile1.jpeg")
      .add("./img/tile2.jpeg")
      .add("./img/tile3.jpeg")
      .add("./img/tile4.jpeg")
      .add("./img/tile5.jpeg")
      .add("./img/tile6.jpeg")
      .add("./img/tile7.jpeg")
      .add("./img/tile8.jpeg")
      .add("./img/tile9.jpeg")
      .add("./img/tile10.jpeg")
      .add("./img/tile11.jpeg")
      .add("./img/tile12.jpeg")
      .add("./img/tile13.jpeg")
      .load(setup);

    let clover1, clover2, clover3, clover4, clover5, clover6, clover7, clover8, clover9, clover10, clover11, clover12, clover13,
      heart1, heart2, heart3, heart4, heart5, heart6, heart7, heart8, heart9, heart10, heart11, heart12, heart13,
      pike1, pike2, pike3, pike4, pike5, pike6, pike7, pike8, pike9, pike10, pike11, pike12, pike13,
      tile1, tile2, tile3, tile4, tile5, tile6, tile7, tile8, tile9, tile10, tile11, tile12, tile13;

    function set_card_sprites() {
      clover1 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover1.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      clover1.width = window.innerWidth * 0.2;
      clover1.height = window.innerHeight * 0.08;


      clover2 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover2.jpeg"].texture
      );

      clover2.width = window.innerWidth * 0.2;
      clover2.height = window.innerHeight * 0.08;


      clover3 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover3.jpeg"].texture
      );

      clover3.width = window.innerWidth * 0.2;
      clover3.height = window.innerHeight * 0.08;


      clover4 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover4.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      clover4.width = window.innerWidth * 0.2;
      clover4.height = window.innerHeight * 0.08;


      clover5 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover5.jpeg"].texture
      );

      clover5.width = window.innerWidth * 0.2;
      clover5.height = window.innerHeight * 0.08;


      clover6 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover6.jpeg"].texture
      );

      clover6.width = window.innerWidth * 0.2;
      clover6.height = window.innerHeight * 0.08;


      clover7 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover7.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      clover7.width = window.innerWidth * 0.2;
      clover7.height = window.innerHeight * 0.08;


      clover8 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover8.jpeg"].texture
      );

      clover8.width = window.innerWidth * 0.2;
      clover8.height = window.innerHeight * 0.08;


      clover9 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover9.jpeg"].texture
      );

      clover9.width = window.innerWidth * 0.2;
      clover9.height = window.innerHeight * 0.08;


      clover10 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover10.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      clover10.width = window.innerWidth * 0.2;
      clover10.height = window.innerHeight * 0.08;


      clover11 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover11.jpeg"].texture
      );

      clover11.width = window.innerWidth * 0.2;
      clover11.height = window.innerHeight * 0.08;


      clover12 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover12.jpeg"].texture
      );

      clover12.width = window.innerWidth * 0.2;
      clover12.height = window.innerHeight * 0.08; 


      clover13 = new PIXI.Sprite(
        PIXI.loader.resources["./img/clover13.jpeg"].texture
      );

      clover13.width = window.innerWidth * 0.2;
      clover13.height = window.innerHeight * 0.08;


      heart1 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart1.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      heart1.width = window.innerWidth * 0.2;
      heart1.height = window.innerHeight * 0.08;


      heart2 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart2.jpeg"].texture
      );

      heart2.width = window.innerWidth * 0.2;
      heart2.height = window.innerHeight * 0.08;


      heart3 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart3.jpeg"].texture
      );

      heart3.width = window.innerWidth * 0.2;
      heart3.height = window.innerHeight * 0.08;


      heart4 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart4.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      heart4.width = window.innerWidth * 0.2;
      heart4.height = window.innerHeight * 0.08;


      heart5 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart5.jpeg"].texture
      );

      heart5.width = window.innerWidth * 0.2;
      heart5.height = window.innerHeight * 0.08;


      heart6 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart6.jpeg"].texture
      );

      heart6.width = window.innerWidth * 0.2;
      heart6.height = window.innerHeight * 0.08;


      heart7 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart7.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      heart7.width = window.innerWidth * 0.2;
      heart7.height = window.innerHeight * 0.08;


      heart8 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart8.jpeg"].texture
      );

      heart8.width = window.innerWidth * 0.2;
      heart8.height = window.innerHeight * 0.08;


      heart9 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart9.jpeg"].texture
      );

      heart9.width = window.innerWidth * 0.2;
      heart9.height = window.innerHeight * 0.08;


      heart10 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart10.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      heart10.width = window.innerWidth * 0.2;
      heart10.height = window.innerHeight * 0.08;


      heart11 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart11.jpeg"].texture
      );

      heart11.width = window.innerWidth * 0.2;
      heart11.height = window.innerHeight * 0.08;


      heart12 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart12.jpeg"].texture
      );

      heart12.width = window.innerWidth * 0.2;
      heart12.height = window.innerHeight * 0.08; 


      heart13 = new PIXI.Sprite(
        PIXI.loader.resources["./img/heart13.jpeg"].texture
      );

      heart13.width = window.innerWidth * 0.2;
      heart13.height = window.innerHeight * 0.08;


      pike1 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike1.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      pike1.width = window.innerWidth * 0.2;
      pike1.height = window.innerHeight * 0.08;


      pike2 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike2.jpeg"].texture
      );

      pike2.width = window.innerWidth * 0.2;
      pike2.height = window.innerHeight * 0.08;


      pike3 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike3.jpeg"].texture
      );

      pike3.width = window.innerWidth * 0.2;
      pike3.height = window.innerHeight * 0.08;


      pike4 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike4.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      pike4.width = window.innerWidth * 0.2;
      pike4.height = window.innerHeight * 0.08;


      pike5 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike5.jpeg"].texture
      );

      pike5.width = window.innerWidth * 0.2;
      pike5.height = window.innerHeight * 0.08;


      pike6 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike6.jpeg"].texture
      );

      pike6.width = window.innerWidth * 0.2;
      pike6.height = window.innerHeight * 0.08;


      pike7 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike7.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      pike7.width = window.innerWidth * 0.2;
      pike7.height = window.innerHeight * 0.08;


      pike8 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike8.jpeg"].texture
      );

      pike8.width = window.innerWidth * 0.2;
      pike8.height = window.innerHeight * 0.08;


      pike9 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike9.jpeg"].texture
      );

      pike9.width = window.innerWidth * 0.2;
      pike9.height = window.innerHeight * 0.08;


      pike10 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike10.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      pike10.width = window.innerWidth * 0.2;
      pike10.height = window.innerHeight * 0.08;


      pike11 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike11.jpeg"].texture
      );

      pike11.width = window.innerWidth * 0.2;
      pike11.height = window.innerHeight * 0.08;


      pike12 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike12.jpeg"].texture
      );

      pike12.width = window.innerWidth * 0.2;
      pike12.height = window.innerHeight * 0.08; 


      pike13 = new PIXI.Sprite(
        PIXI.loader.resources["./img/pike13.jpeg"].texture
      );

      pike13.width = window.innerWidth * 0.2;
      pike13.height = window.innerHeight * 0.08;


      tile1 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile1.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      tile1.width = window.innerWidth * 0.2;
      tile1.height = window.innerHeight * 0.08;


      tile2 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile2.jpeg"].texture
      );

      tile2.width = window.innerWidth * 0.2;
      tile2.height = window.innerHeight * 0.08;


      tile3 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile3.jpeg"].texture
      );

      tile3.width = window.innerWidth * 0.2;
      tile3.height = window.innerHeight * 0.08;


      tile4 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile4.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      tile4.width = window.innerWidth * 0.2;
      tile4.height = window.innerHeight * 0.08;


      tile5 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile5.jpeg"].texture
      );

      tile5.width = window.innerWidth * 0.2;
      tile5.height = window.innerHeight * 0.08;


      tile6 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile6.jpeg"].texture
      );

      tile6.width = window.innerWidth * 0.2;
      tile6.height = window.innerHeight * 0.08;


      tile7 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile7.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      tile7.width = window.innerWidth * 0.2;
      tile7.height = window.innerHeight * 0.08;


      tile8 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile8.jpeg"].texture
      );

      tile8.width = window.innerWidth * 0.2;
      tile8.height = window.innerHeight * 0.08;


      tile9 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile9.jpeg"].texture
      );

      tile9.width = window.innerWidth * 0.2;
      tile9.height = window.innerHeight * 0.08;


      tile10 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile10.jpeg"].texture
      );
      //sprite.anchor.set(0,1);

      tile10.width = window.innerWidth * 0.2;
      tile10.height = window.innerHeight * 0.08;


      tile11 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile11.jpeg"].texture
      );

      tile11.width = window.innerWidth * 0.2;
      tile11.height = window.innerHeight * 0.08;


      tile12 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile12.jpeg"].texture
      );

      tile12.width = window.innerWidth * 0.2;
      tile12.height = window.innerHeight * 0.08; 


      tile13 = new PIXI.Sprite(
        PIXI.loader.resources["./img/tile13.jpeg"].texture
      );

      tile13.width = window.innerWidth * 0.2;
      tile13.height = window.innerHeight * 0.08;
    }

    function setup() {
      set_card_sprites();

      let draw = new PIXI.Sprite(
        PIXI.loader.resources["./img/drawCard.jpeg"].texture
      );

      draw.width = window.innerWidth * 0.3;
      draw.height = window.innerHeight * 0.05;
      draw.x = window.innerWidth / 2 - draw.width / 2;
      draw.y = window.innerHeight / 2 + 2.5 * draw.height;
      app.stage.addChild(draw);

      const cards = [clover1, clover2, clover3, clover4, clover5, clover6, clover7, clover8, clover9, clover10, clover11, clover12, clover13,
      heart1, heart2, heart3, heart4, heart5, heart6, heart7, heart8, heart9, heart10, heart11, heart12, heart13,
      pike1, pike2, pike3, pike4, pike5, pike6, pike7, pike8, pike9, pike10, pike11, pike12, pike13,
      tile1, tile2, tile3, tile4, tile5, tile6, tile7, tile8, tile9, tile10, tile11, tile12, tile13];
      
      let beginning_card = [];


      while(beginning_card.length < 52) {
        let random = Math.floor(Math.random() * 52);
        if(!beginning_card.includes(random)) {
          beginning_card.push(random);
        }  
      }

      let my_card = beginning_card.slice(0,6);
      let left_card = beginning_card.slice(6,12);
      let top_card = beginning_card.slice(12,18);
      let right_card = beginning_card.slice(18,24);
      let middle_card = beginning_card.slice(24,28);
      let on_top_of_the_cards = 28;

      const ORIGINAL_WIDTH = window.innerWidth * 0.2;
      const ORIGINAL_HEIGHT = window.innerHeight * 0.08;

      console.log(beginning_card)
      console.log(my_card)
      console.log(left_card)
      console.log(right_card)
      console.log(top_card)
      console.log(middle_card)

      // 自己的牌
      function show_my_card() {console.log(my_card)
        my_card.forEach((card, i) => {
          if(i < 3) {
            cards[card].x = ((window.innerWidth - 3 * ORIGINAL_WIDTH) / 4) * (i + 1) + i * ORIGINAL_WIDTH;
            cards[card].y = window.innerHeight - 2 * ORIGINAL_HEIGHT - 120;
            app.stage.addChild(cards[card]);
          } else {
            cards[card].x = ((window.innerWidth - 3 * ORIGINAL_WIDTH) / 4) * (i - 2) + (i - 3) * ORIGINAL_WIDTH;
            cards[card].y = window.innerHeight - ORIGINAL_HEIGHT - 60;
            app.stage.addChild(cards[card]);
          }
        });
      }

      show_my_card();


      // 左邊玩家
      function show_left_card() {
        left_card.forEach((card, i) => {
          cards[card].width = cards[card].width * 0.5;
          cards[card].height = cards[card].height * 0.5;

          if(i < 2) {
            cards[card].x = ((window.innerWidth - 4 * cards[card].width) / 14) * (i + 1) + i * cards[card].width;
            cards[card].y = window.innerHeight / 2 - 2 * cards[card].height;
            app.stage.addChild(cards[card]);
          } else if(i < 4) {
            cards[card].x = ((window.innerWidth - 4 * cards[card].width) / 14) * (i - 1) + (i - 2) * cards[card].width;
            cards[card].y = window.innerHeight / 2 - 0.5 * cards[card].height;
            app.stage.addChild(cards[card]);
          } else {
            cards[card].x = ((window.innerWidth - 4 * cards[card].width) / 14) * (i - 3) + (i - 4) * cards[card].width;
            cards[card].y = window.innerHeight / 2 + 1 * cards[card].height;
            app.stage.addChild(cards[card]);
          }
        });
      }

      show_left_card();
      

      // 上方玩家
      function show_top_card() {
        top_card.forEach((card, i) => {
          cards[card].width = cards[card].width * 0.5;
          cards[card].height = cards[card].height * 0.5;
          
          if(i < 3) {
            cards[card].x = ((window.innerWidth - 600 - 3 * cards[card].width) / 2) * i + i * cards[card].width + 300;
            cards[card].y = 30;
            app.stage.addChild(cards[card]);
          } else {
            cards[card].x = ((window.innerWidth - 600 - 3 * cards[card].width) / 2) * (i - 3) + (i - 3) * cards[card].width + 300;
            cards[card].y = cards[card].height + 30 + 30;
            app.stage.addChild(cards[card]);
          }
        });
      }

      show_top_card();


      // 右邊玩家
      function show_right_card() {
        right_card.forEach((card, i) => {
          cards[card].width = cards[card].width * 0.5;
          cards[card].height = cards[card].height * 0.5;

          if(i < 2) {
            cards[card].x = ((window.innerWidth - 4 * cards[card].width) / 14) * (i + 12) + (i + 2) * cards[card].width;
            cards[card].y = window.innerHeight / 2 - 2 * cards[card].height;
            app.stage.addChild(cards[card]);
          } else if(i < 4) {
            cards[card].x = ((window.innerWidth - 4 * cards[card].width) / 14) * (i + 10) + i * cards[card].width;
            cards[card].y = window.innerHeight / 2 - 0.5 * cards[card].height;
            app.stage.addChild(cards[card]);
          } else {
            cards[card].x = ((window.innerWidth - 4 * cards[card].width) / 14) * (i + 8) + (i - 2) * cards[card].width;
            cards[card].y = window.innerHeight / 2 + 1 * cards[card].height;
            app.stage.addChild(cards[card]);
          }
        });
      }

      show_right_card();


      //中間翻牌
      function show_middle_card() {console.log(middle_card)
        middle_card.forEach((card, i) => {
          cards[card].tint = 0.3 * 0xFFFFFF;

          cards[card].width = ORIGINAL_WIDTH * 0.5;
          cards[card].height = ORIGINAL_HEIGHT * 0.5;

          if(i < 2) {
            cards[card].x = (window.innerWidth - 1000 - 2 * cards[card].width) * i + i * cards[card].width + 500;
            cards[card].y = window.innerHeight / 2 - cards[card].height - 15;

            app.stage.addChild(cards[card]);
          } else {
            cards[card].x = (window.innerWidth - 1000 - 2 * cards[card].width) * (i - 2) + (i - 2) * cards[card].width + 500;
            cards[card].y = window.innerHeight / 2 + 15;
            app.stage.addChild(cards[card]);
          }
        });
      }

      show_middle_card();


      function drawCard() {
        my_card.push(beginning_card[on_top_of_the_cards]);
        on_top_of_the_cards++;
        currentPlayer++;
        round();
        show_my_card();
      }


      function onClick (event, index) {
        let my_match = [];
        if(index % 13 > 8) {
          my_card.forEach((myCard, i) => {
            if(myCard % 13 === index % 13) {
              my_match.push(i);
            }

            if(i === my_card.length - 1) {
              let middleCardIndex = middle_card.indexOf(index);
              middle_card.splice(middleCardIndex, 1, beginning_card[on_top_of_the_cards]);
              my_card.splice(my_match[0], 1);
              on_top_of_the_cards++;

              app.stage.removeChild(event.target);
              app.stage.removeChild(cards[my_card[my_match[0]]]);
              currentPlayer++;
              match++;
              round();
              show_middle_card();
              show_my_card();
            }
          });
        } else {
          my_card.forEach((myCard, i) => {
            if(myCard % 13 + index % 13 === 8) {
              my_match.push(i);
            }

            if(i === my_card.length - 1) {
              let middleCardIndex = middle_card.indexOf(index);
              middle_card.splice(middleCardIndex, 1, beginning_card[on_top_of_the_cards]);
              my_card.splice(my_match[0], 1);
              on_top_of_the_cards++;

              app.stage.removeChild(event.target);
              app.stage.removeChild(cards[my_card[my_match[0]]]);
              currentPlayer++;
              match++;
              round();
              show_middle_card();
              show_my_card();
            }
          });
        }
      }

      function round() {
        if(currentPlayer === 0) {
          draw.interactive = true;
          draw.buttonMode = true;
          draw.on('pointerdown', drawCard);

          middle_card.forEach((middle) => {
            cards[middle].interactive = true;
            cards[middle].buttonMode = true;
            cards[middle].on('pointerdown', (e) => onClick(e, middle));
          });
        } else {
          draw.interactive = false;
          draw.buttonMode = false;

          middle_card.forEach((middle) => {
            cards[middle].interactive = false;
            cards[middle].buttonMode = false;
          });
        }
      }

      let currentPlayer = 0;
      let match = 0;

      round();

      
      // while(match < 26) {
      //   round();
      //   match++;
      // }
      
      

    }
  </script>
</body>
</html>